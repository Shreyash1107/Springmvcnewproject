package org.controller;

import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.model.DepartmentModel;
import org.service.DepartmentService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class DepartmentController {
	@Autowired
	DepartmentService deptservice;

	@RequestMapping(value = "/adddept")
	public String adddept() {
		return "AddDepartment";
	}

	@RequestMapping(value = "/savedept")
	public String addepartment(DepartmentModel deptmodel, Map map) {
		boolean b = deptservice.isDepartmentAded(deptmodel);
		if (b) {
			map.put("dept", "Department has been Successfully Added.......");
			return "AddDepartment";
		} else {
			return "Admindashboard";
		}
	}

	@RequestMapping(value = "/viewdept")
	public String viewdept(Map<String, List<DepartmentModel>> map) {
		List<DepartmentModel> deptlist = deptservice.getdept();
		if (deptlist != null) {
			map.put("d", deptlist);
			return "viewdepartment";
		} else {
			return "Admindashboard";
		}
	}

	@RequestMapping(value = "/delete")
	public String deleteDeptId(@RequestParam(value = "dept_id", required = false) Integer dept_id, Map map) {
	    if (dept_id != null) {
	        deptservice.isDepartmentdeleted(dept_id);
	    }
	    List<DepartmentModel> list = deptservice.getdept();
	    if (list != null) {
	        map.put("d", list);
	    }
	    return "viewdepartment";
	}


	@RequestMapping(value = "/update")
	public String updatedept(@RequestParam("dept_id") Integer deptid, @RequestParam("dept_name") String name,
			Map<String, Object> map) {
		map.put("deptid", deptid);
		map.put("deptname", name);
		return "Updatedept";
	}

	@RequestMapping(value = "/finalupdate")
	public String getUpdatedDetails(DepartmentModel dmodel1, @RequestParam("dept_id") Integer deptid, 
	                                @RequestParam("dept_name") String name, Map<String, Object> map) {
	    if (name == null || name.trim().isEmpty()) {
	        map.put("error", "Department Name cannot be null or empty.");
	        return "Updatedept"; // Return to the update form with an error message
	    }

	    dmodel1.setDept_id(deptid);
	    dmodel1.setDept_name(name);

	    boolean isUpdated = deptservice.isupdateDepartment(dmodel1);
	    if (isUpdated) {
	        List<DepartmentModel> updatedList = deptservice.getdept();
	        map.put("d", updatedList);
	        return "viewdepartment"; // Redirect to the view department page after successful update
	    } else {
	        map.put("error", "Failed to update the department.");
	        return "Updatedept"; // Return to the update form with an error message
	    }
	}

}
