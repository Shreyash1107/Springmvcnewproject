@Repository("deptrepo")
public class DepartmentRespositoryImpl implements Departmentrepository {

    @Autowired
    JdbcTemplate template;

    @Override
    public boolean isDepartmentAded(DepartmentModel dmodel) {
        String deptName = dmodel.getDept_name().trim().toLowerCase(); // Trim and normalize case
        
        // Check if a department with the same name already exists
        int count = template.queryForObject(
            "SELECT COUNT(*) FROM department WHERE LOWER(TRIM(deptname)) = ?", 
            new Object[]{deptName}, 
            Integer.class
        );

        // If a department already exists, return false
        if (count > 0) {
            return false;
        }

        // If no department exists, insert the new department
        int val = template.update(
            "INSERT INTO department (dept_id, deptname) VALUES (0, ?)", 
            deptName
        );
        return val > 0; // Return true if insertion is successful
    }

    @Override
    public List<DepartmentModel> getdept() {
        return template.query(
            "SELECT * FROM department ORDER BY dept_id ASC", 
            new RowMapper<DepartmentModel>() {
                @Override
                public DepartmentModel mapRow(ResultSet rs, int rowNum) throws SQLException {
                    DepartmentModel dmodel = new DepartmentModel();
                    dmodel.setDept_id(rs.getInt("dept_id"));
                    dmodel.setDept_name(rs.getString("deptname"));
                    return dmodel;
                }
            }
        );
    }

    @Override
    public void isDepartmentdeleted(int dept_id) {
        template.update("DELETE FROM department WHERE dept_id = ?", dept_id);
    }

    @Override
    public boolean isupdateDepartment(DepartmentModel deptmodel) {
        int value = template.update(
            "UPDATE department SET deptname = ? WHERE dept_id = ?", 
            deptmodel.getDept_name().trim().toLowerCase(), // Trim and normalize case
            deptmodel.getDept_id()
        );
        return value > 0; // Return true if update is successful
    }
}
