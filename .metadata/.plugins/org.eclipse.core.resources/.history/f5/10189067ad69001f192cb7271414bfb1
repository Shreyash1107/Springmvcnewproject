<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="<c:url value='/resources/CSS/alumni.css' />" rel="stylesheet" />
<script src="resources/JS/pagination.js"></script>
<script src="resources/JS/alert.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin</a>
        </div>
    </nav>
    <div class="sidebar">
        <h3 class="text-center">Admin Dashboard</h3>
        <a href="department">Department Module</a> 
        <a href="btchmodel">Batch Module</a> 
        <a href="alumni">Alumni Module</a> 
        <a href="events">Event Module</a> 
        <a href="#">Feedback Module</a> 
        <a href="logout">Log out</a>
    </div>
    <div class="content">
        <h4 class="text-center">Alumni Module</h4>

        <!-- Existing Form -->
        <form name="frm" action="save" method="POST">
            <!-- Form content here -->
        </form>

        <!-- Search Box -->
        <div class="container">
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="form-group">
                        <input type="text" class="form-control" id="searchQuery" placeholder="Search by name..." />
                    </div>
                </div>
                <div class="col-md-12 mt-2 text-center">
                    <button type="button" id="searchButton" class="btn btn-info">Search</button>
                </div>
            </div>
        </div>

        <c:if test="${not empty a}">
            <div class="alert alert-warning mt-4 text-center" id="message-alert">${a}</div>
        </c:if>
        
        <div class="col-md-12 mt-5">
            <div class="table-responsive">
                <table id="data" class="table table-striped table-dark text-center">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Aid</th>
                            <th scope="col">Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Contact</th>
                            <th scope="col">Age</th>
                            <th scope="col">Company</th>
                            <th scope="col">Gender</th>
                            <th scope="col">Dept_id</th>
                            <th scope="col">Bid</th>
                            <th scope="col">Update</th>
                            <th scope="col">Delete</th>
                        </tr>
                    </thead>
                    <tbody id="alumniTableBody">
                        <!-- Table content here -->
                    </tbody>
                </table>
            </div>
            <div id="nav" class="pagination-container d-flex justify-content-center mt-4"></div>
        </div>
        
        <div class="text-center mt-4">
            <a href="deptalumni" class="btn btn-success">View Department Wise Alumni</a> 
            <a href="batchalumni" class="btn btn-warning">View Batch Year Wise Alumni</a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- JavaScript for AJAX Search -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchButton').addEventListener('click', function() {
                var query = document.getElementById('searchQuery').value;
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/search?query=' + encodeURIComponent(query), true);
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var response = JSON.parse(xhr.responseText);
                        var tbody = document.getElementById('alumniTableBody');
                        tbody.innerHTML = ''; // Clear existing table rows
                        response.forEach(function(alumni) {
                            var row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${alumni.aid}</td>
                                <td>${alumni.name}</td>
                                <td>${alumni.email}</td>
                                <td>${alumni.contact}</td>
                                <td>${alumni.age}</td>
                                <td>${alumni.company}</td>
                                <td>${alumni.gender}</td>
                                <td>${alumni.dept_id}</td>
                                <td>${alumni.bid}</td>
                                <td><a href="updatealumni?aid=${alumni.aid}&name=${alumni.name}&email=${alumni.email}&Contact=${alumni.contact}&Age=${alumni.age}&Company=${alumni.company}&Gender=${alumni.gender}&Bid=${alumni.bid}&dept_id=${alumni.dept_id}" class="btn btn-warning" role="button">Update</a></td>
                                <td><a href="del?aid=${alumni.aid}" class="btn btn-danger" role="button">Delete</a></td>
                            `;
                            tbody.appendChild(row);
                        });
                    } else {
                        alert('Error occurred while searching');
                    }
                };
                xhr.send();
            });
        });
    </script>
</body>
</html>
